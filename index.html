<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Modern Gemini AI Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">
  <div class="max-w-6xl mx-auto h-screen flex flex-col px-4 py-6">
    <!-- HEADER -->
    <header class="flex items-center justify-between gap-4">
      <div>
        <h1 class="text-2xl md:text-3xl font-semibold tracking-tight">
          Gemini Chat Workspace
        </h1>
        <p class="text-sm text-slate-500 mt-1">
          Ruang kerja tenang untuk eksplorasi ide, coding, dan brainstorming.
        </p>
      </div>
      <div class="hidden sm:flex items-center gap-3">
        <span class="text-xs uppercase tracking-wide text-slate-500">
          Powered by
        </span>
        <span class="px-3 py-1 rounded-full bg-slate-900 text-slate-50 text-xs font-medium">
          Gemini 2.5 Flash
        </span>
      </div>
    </header>

    <!-- MAIN -->
    <main class="flex-1 flex flex-col lg:flex-row gap-6 mt-6 min-h-0">
      <!-- CHAT PANEL -->
      <section class="flex-1 flex flex-col bg-white border border-slate-200 rounded-3xl shadow-sm overflow-hidden">
        <!-- Chat messages -->
        <div
          id="chat-box"
          class="flex-1 overflow-y-auto px-6 py-4 space-y-4 scroll-smooth"
        >
          <!-- Initial AI message -->
          <div class="flex items-start gap-3">
            <div
              class="shrink-0 bg-slate-900 w-9 h-9 rounded-full flex justify-center items-center text-xs font-semibold tracking-tight"
            >
              AI
            </div>
            <div
              class="bg-slate-100 text-slate-900 px-4 py-3 rounded-2xl rounded-tl-sm text-sm max-w-xl"
            >
              Halo, saya Gemini. Ceritakan apa yang sedang kamu kerjakan hari ini. ðŸ‘‹
            </div>
          </div>
        </div>

        <!-- Suggestion chips from AI -->
        <div
          id="suggestions"
          class="px-6 pt-3 pb-2 border-t border-slate-100 bg-slate-50/80 flex flex-wrap gap-2 text-sm"
        >
          <!-- diisi dinamis dari AI -->
        </div>

        <!-- Input area -->
        <div
          class="px-4 py-3 border-t border-slate-200 bg-white flex items-end gap-3"
        >
          <div class="flex-1 relative">
            <textarea
              id="prompt"
              rows="1"
              class="w-full resize-none rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 pr-10 text-sm outline-none focus:border-slate-400 focus:ring-1 focus:ring-slate-300"
              placeholder="Tulis pesan atau tempelkan kode di sini..."
            ></textarea>
            <span
              class="absolute right-3 bottom-2 text-[10px] text-slate-400 select-none"
            >
              Enter untuk kirim Â· Shift+Enter baris baru
            </span>
          </div>
          <button
            id="sendBtn"
            class="shrink-0 inline-flex items-center gap-2 rounded-2xl px-4 py-2.5 text-sm font-medium bg-slate-900 text-slate-50 hover:bg-slate-800 active:scale-[0.98] transition"
          >
            <span>Kirim</span>
            <span class="text-xs">â®ž</span>
          </button>
        </div>
      </section>

      <!-- SIDE PANEL (optional info / status) -->
      <aside
        class="hidden lg:flex w-72 flex-col gap-4 text-sm text-slate-600"
      >
        <div class="bg-white border border-slate-200 rounded-3xl p-4 shadow-sm">
          <h2 class="text-xs font-semibold tracking-wide text-slate-500 uppercase">
            Session Snapshot
          </h2>
          <div class="mt-3 space-y-3 text-xs">
            <div class="flex items-center justify-between">
              <span class="text-slate-500">Mode</span>
              <span class="px-2 py-1 rounded-full bg-slate-100 text-slate-900">
                Light only
              </span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-slate-500">Focus</span>
              <span>Konsultasi, coding, & brainstorming</span>
            </div>
          </div>
        </div>

        <div class="bg-white border border-slate-200 rounded-3xl p-4 shadow-sm">
          <h2 class="text-xs font-semibold tracking-wide text-slate-500 uppercase">
            Tips singkat
          </h2>
          <ul class="mt-3 space-y-2 list-disc list-inside text-xs">
            <li>Berikan konteks singkat tentang tujuan kamu.</li>
            <li>Untuk kode, sebutkan stack / framework yang dipakai.</li>
            <li>Minta saran alternatif jika ingin eksplorasi ide baru.</li>
          </ul>
        </div>
      </aside>
    </main>
  </div>

  <script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    const API_KEY = "AIzaSyBlyZScLwO6NnvfqiInNf2saHFajvI4-N8"; // TODO: ganti dengan API key kamu sendiri
    const genAI = new GoogleGenerativeAI(API_KEY);
    const model = genAI.getGenerativeModel({ model: "gemini-2.5-flash" });

    const chatBox = document.getElementById("chat-box");
    const promptInput = document.getElementById("prompt");
    const sendBtn = document.getElementById("sendBtn");
    const suggestionsEl = document.getElementById("suggestions");

    // -------------------------------
    // Helper: buat elemen bubble chat
    // -------------------------------
    function addMessage(role, text) {
      const wrapper = document.createElement("div");

      if (role === "user") {
        wrapper.className = "flex justify-end";
      } else {
        wrapper.className = "flex items-start gap-3";
      }

      const bubble = document.createElement("div");

      if (role === "user") {
        bubble.className =
          "bg-slate-900 text-slate-50 px-4 py-3 rounded-2xl rounded-br-sm text-sm max-w-xl";
        bubble.textContent = text;
        wrapper.appendChild(bubble);
      } else {
        const avatar = document.createElement("div");
        avatar.className =
          "shrink-0 bg-slate-900 w-8 h-8 rounded-full flex justify-center items-center text-[10px] font-semibold tracking-tight";
        avatar.textContent = "AI";

        bubble.className =
          "bg-slate-100 text-slate-900 px-4 py-3 rounded-2xl rounded-tl-sm text-sm max-w-xl whitespace-pre-wrap";
        bubble.textContent = text;

        wrapper.appendChild(avatar);
        wrapper.appendChild(bubble);
      }

      chatBox.appendChild(wrapper);
      chatBox.scrollTop = chatBox.scrollHeight;

      return { wrapper, bubble };
    }

    // -------------------------------
    // Helper: render suggestion chips
    // -------------------------------
    function renderSuggestions(items) {
      suggestionsEl.innerHTML = "";
      if (!items || !items.length) return;

      // Shuffle biar urutan random tiap kali
      for (let i = items.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [items[i], items[j]] = [items[j], items[i]];
      }

      items.slice(0, 4).forEach((s) => {
        const btn = document.createElement("button");
        btn.className =
          "px-3 py-1.5 rounded-full border border-slate-200 bg-white text-slate-700 hover:border-slate-400 text-xs inline-flex items-center gap-2 transition";
        btn.textContent = s;
        btn.addEventListener("click", () => handleSuggestionClick(s));
        suggestionsEl.appendChild(btn);
      });
    }

    function handleSuggestionClick(text) {
      promptInput.value = text;
      sendMessage();
    }

    // -------------------------------
    // Generate suggestion dari AI
    // -------------------------------
    async function generateAISuggestions(userPrompt, aiReply) {
      const systemPrompt = `
Berdasarkan percakapan berikut (pertanyaan dan jawaban), buat 3 ide pertanyaan lanjutan dalam Bahasa Indonesia.
Syarat:
- Singkat, maksimal 10 kata
- Relevan dengan topik
- Format output HARUS hanya JSON array string, tanpa penjelasan lain
Contoh: ["Pertanyaan 1", "Pertanyaan 2", "Pertanyaan 3"]
`;

      try {
        const result = await model.generateContent([
          {
            role: "user",
            parts: [
              {
                text:
                  systemPrompt +
                  "\n\nPertanyaan: " +
                  userPrompt +
                  "\nJawaban: " +
                  aiReply,
              },
            ],
          },
        ]);

        let text = result.response.text().trim();
        // bersihkan jika model pakai ```json ```
        text = text.replace(/```json/gi, "").replace(/```/g, "").trim();

        const parsed = JSON.parse(text);
        if (Array.isArray(parsed)) {
          renderSuggestions(parsed.filter((x) => typeof x === "string"));
        }
      } catch (err) {
        console.warn("Gagal membuat suggestion:", err);
      }
    }

    // -------------------------------
    // SEND MESSAGE
    // -------------------------------
    async function sendMessage() {
      const prompt = promptInput.value.trim();
      if (!prompt) return;

      // clear suggestion lama biar ga misleading
      suggestionsEl.innerHTML = "";

      addMessage("user", prompt);
      promptInput.value = "";
      promptInput.style.height = "auto";

      const thinking = addMessage("ai", "â³ Sedang berpikir...");

      sendBtn.disabled = true;
      sendBtn.classList.add("opacity-70", "cursor-not-allowed");

      try {
        const result = await model.generateContent(prompt);
        const reply = result.response.text();
        thinking.bubble.textContent = reply;

        // generate suggestion lanjutan berdasarkan AI
        generateAISuggestions(prompt, reply);
      } catch (err) {
        console.error(err);
        thinking.bubble.textContent = "âŒ Terjadi error: " + err.message;
      } finally {
        sendBtn.disabled = false;
        sendBtn.classList.remove("opacity-70", "cursor-not-allowed");
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    }

    // -------------------------------
    // Textarea autosize + key handler
    // -------------------------------
    promptInput.addEventListener("input", () => {
      promptInput.style.height = "auto";
      promptInput.style.height = promptInput.scrollHeight + "px";
    });

    sendBtn.addEventListener("click", sendMessage);

    promptInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>
