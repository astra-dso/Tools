<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <title>PDF Tools - Frontend Only</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- pdf-lib (untuk manipulasi PDF) -->
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>

    <!-- pdf.js (untuk render PDF ke image) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.min.mjs" type="module"></script>

    <style>
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    </style>
</head>
<body class="bg-white text-gray-800">

<div class="min-h-screen flex items-start justify-center">
    <div class="max-w-7xl w-full px-6 py-8">

        <h1 class="text-2xl font-semibold text-gray-700 mb-6">
            PDF Tools (Frontend Only)
        </h1>

        <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">

            <!-- SIDEBAR MENU -->
            <div class="lg:col-span-2">
                <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6 text-sm">

                    <!-- ATUR PDF -->
                    <div>
                        <h2 class="text-xs font-semibold tracking-wide text-gray-500 mb-3">
                            ATUR PDF
                        </h2>
                        <ul class="space-y-2">
                            <li class="flex items-center cursor-pointer tool-item" data-tool="merge">
                                <span class="w-7 h-7 mr-3 rounded bg-red-500 flex items-center justify-center text-white text-xs">
                                    +
                                </span>
                                <span class="text-red-600 font-semibold">Gabungkan PDF</span>
                            </li>
                            <li class="flex items-center cursor-pointer tool-item" data-tool="split">
                                <span class="w-7 h-7 mr-3 rounded bg-red-500 flex items-center justify-center text-white text-xs">
                                    ||
                                </span>
                                <span>Pisahkan / Ekstrak halaman</span>
                            </li>
                            <li class="flex items-center cursor-pointer tool-item" data-tool="deletePages">
                                <span class="w-7 h-7 mr-3 rounded bg-red-500 flex items-center justify-center text-white text-xs">
                                    âœ•
                                </span>
                                <span>Hapus halaman</span>
                            </li>
                            <li class="flex items-center cursor-pointer tool-item" data-tool="reorder">
                                <span class="w-7 h-7 mr-3 rounded bg-red-500 flex items-center justify-center text-white text-xs">
                                    â˜°
                                </span>
                                <span>Atur urutan PDF</span>
                            </li>
                            <li class="flex items-center cursor-pointer tool-item" data-tool="scanToPdf">
                                <span class="w-7 h-7 mr-3 rounded bg-red-500 flex items-center justify-center text-white text-xs">
                                    ðŸ“·
                                </span>
                                <span>Pindai ke PDF (gambar â†’ PDF)</span>
                            </li>
                        </ul>
                    </div>

                    <!-- OPTIMALKAN PDF -->
                    <div>
                        <h2 class="text-xs font-semibold tracking-wide text-gray-500 mb-3">
                            OPTIMALKAN PDF
                        </h2>
                        <ul class="space-y-2">
                            <li class="flex items-center cursor-pointer tool-item" data-tool="compress">
                                <span class="w-7 h-7 mr-3 rounded bg-green-500 flex items-center justify-center text-white text-xs">
                                    â¬‡
                                </span>
                                <span>Kompres ringan (re-save)</span>
                            </li>
                            <li class="flex items-center cursor-pointer" onclick="notImplemented('Perbaiki PDF / OCR butuh backend / layanan khusus.')">
                                <span class="w-7 h-7 mr-3 rounded bg-green-500 flex items-center justify-center text-white text-xs">
                                    ðŸ› 
                                </span>
                                <span>Perbaiki / OCR PDF (butuh server)</span>
                            </li>
                        </ul>
                    </div>

                    <!-- KONVERSI KE PDF -->
                    <div>
                        <h2 class="text-xs font-semibold tracking-wide text-gray-500 mb-3">
                            KONVERSI KE PDF
                        </h2>
                        <ul class="space-y-2">
                            <li class="flex items-center cursor-pointer tool-item" data-tool="imagesToPdf">
                                <span class="w-7 h-7 mr-3 rounded bg-yellow-400 flex items-center justify-center text-white text-xs">
                                    JPG
                                </span>
                                <span>JPG/PNG ke PDF</span>
                            </li>
                            <li class="flex items-center cursor-pointer" onclick="notImplemented('WORD/EXCEL/PPT â†’ PDF butuh server (LibreOffice, dll).')">
                                <span class="w-7 h-7 mr-3 rounded bg-blue-500 flex items-center justify-center text-white text-xs">
                                    W
                                </span>
                                <span>WORD / EXCEL / PPT ke PDF (butuh server)</span>
                            </li>
                        </ul>
                    </div>

                    <!-- KONVERSI DARI PDF -->
                    <div>
                        <h2 class="text-xs font-semibold tracking-wide text-gray-500 mb-3">
                            KONVERSI DARI PDF
                        </h2>
                        <ul class="space-y-2">
                            <li class="flex items-center cursor-pointer tool-item" data-tool="pdfToImages">
                                <span class="w-7 h-7 mr-3 rounded bg-yellow-400 flex items-center justify-center text-white text-xs">
                                    JPG
                                </span>
                                <span>PDF ke JPG/PNG</span>
                            </li>
                            <li class="flex items-center cursor-pointer" onclick="notImplemented('PDF â†’ Word/Excel/PPT/HTML hi-fidelity butuh server.')">
                                <span class="w-7 h-7 mr-3 rounded bg-gray-500 flex items-center justify-center text-white text-xs">
                                    â‡„
                                </span>
                                <span>PDF ke Word/Excel/PPT/HTML (butuh server)</span>
                            </li>
                        </ul>
                    </div>

                    <!-- EDIT PDF -->
                    <div>
                        <h2 class="text-xs font-semibold tracking-wide text-gray-500 mb-3">
                            EDIT PDF
                        </h2>
                        <ul class="space-y-2">
                            <li class="flex items-center cursor-pointer tool-item" data-tool="rotate">
                                <span class="w-7 h-7 mr-3 rounded bg-pink-500 flex items-center justify-center text-white text-xs">
                                    â†»
                                </span>
                                <span>Putar halaman</span>
                            </li>
                            <li class="flex items-center cursor-pointer tool-item" data-tool="pageNumbers">
                                <span class="w-7 h-7 mr-3 rounded bg-pink-500 flex items-center justify-center text-white text-xs">
                                    #
                                </span>
                                <span>Tambah nomor halaman</span>
                            </li>
                            <li class="flex items-center cursor-pointer tool-item" data-tool="watermark">
                                <span class="w-7 h-7 mr-3 rounded bg-pink-500 flex items-center justify-center text-white text-xs">
                                    ðŸ’§
                                </span>
                                <span>Tambah watermark teks</span>
                            </li>
                            <li class="flex items-center cursor-pointer" onclick="notImplemented('Crop / edit konten PDF detail butuh logic lebih kompleks / backend.')">
                                <span class="w-7 h-7 mr-3 rounded bg-pink-500 flex items-center justify-center text-white text-xs">
                                    âœ‚
                                </span>
                                <span>Potong / Edit konten lanjut (butuh backend)</span>
                            </li>
                        </ul>
                    </div>

                    <!-- KEAMANAN PDF -->
                    <div>
                        <h2 class="text-xs font-semibold tracking-wide text-gray-500 mb-3">
                            KEAMANAN PDF
                        </h2>
                        <ul class="space-y-2">
                            <li class="flex items-center cursor-pointer" onclick="notImplemented('Buka PDF terkunci password kuat harus dari server / user sendiri.')">
                                <span class="w-7 h-7 mr-3 rounded bg-blue-700 flex items-center justify-center text-white text-xs">
                                    ðŸ”“
                                </span>
                                <span>Buka PDF terkunci (butuh server)</span>
                            </li>
                            <li class="flex items-center cursor-pointer" onclick="notImplemented('Proteksi / tanda tangan digital yang aman idealnya di server.')">
                                <span class="w-7 h-7 mr-3 rounded bg-blue-700 flex items-center justify-center text-white text-xs">
                                    ðŸ”’
                                </span>
                                <span>Proteksi / Tanda tangan / Bandingkan (butuh server)</span>
                            </li>
                        </ul>
                    </div>

                </div>
            </div>

            <!-- TOOL PANEL -->
            <div class="lg:col-span-3">
                <div id="toolPanel" class="border border-gray-200 rounded-xl p-4 bg-gray-50 text-sm">
                    <p class="text-gray-600">
                        Klik salah satu tool di panel kiri. Form & fungsi untuk tool tersebut akan tampil di sini.
                    </p>
                </div>
            </div>
        </div>

        <!-- LOG AREA -->
        <div id="logBox"
             class="mt-6 text-xs text-gray-600 border border-dashed border-gray-300 rounded p-3 bg-gray-50 max-h-48 overflow-auto">
            <strong>Log:</strong>
            <div id="logContent"></div>
        </div>

    </div>
</div>

<script type="module">
    // pdf.js sudah di-load sebagai module di atas (script type="module")
</script>

<script>
    // ===== UTIL =====
    function log(msg) {
        const el = document.getElementById('logContent');
        const line = document.createElement('div');
        line.textContent = new Date().toLocaleTimeString() + ' - ' + msg;
        el.prepend(line);
    }

    function notImplemented(msg) {
        alert(msg);
        log('Fitur belum diimplementasikan di frontend-only: ' + msg);
    }

    function downloadBytes(bytes, filename, mime) {
        const blob = new Blob([bytes], { type: mime });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
    }

    // ===== TOOL MENU HANDLER =====
    const toolPanel = document.getElementById('toolPanel');

    const tools = {
        merge() {
            toolPanel.innerHTML = `
                <h2 class="text-lg font-semibold mb-3">Gabungkan PDF</h2>
                <p class="text-xs text-gray-600 mb-3">
                    Pilih beberapa file PDF, urutan sesuai urutan pilih, lalu klik <strong>Gabungkan</strong>.
                </p>
                <input id="mergeFiles" type="file" accept="application/pdf" multiple
                       class="block mb-3 text-xs" />
                <button id="mergeRun"
                        class="px-3 py-1.5 rounded bg-red-500 text-white text-xs font-semibold">
                    Gabungkan
                </button>
            `;

            document.getElementById('mergeRun').addEventListener('click', async () => {
                const input = document.getElementById('mergeFiles');
                const files = Array.from(input.files || []);
                if (!files.length) return alert('Pilih minimal 2 file PDF.');

                log('Menggabungkan ' + files.length + ' PDF...');
                const mergedPdf = await PDFLib.PDFDocument.create();

                for (const file of files) {
                    const bytes = await file.arrayBuffer();
                    const pdf = await PDFLib.PDFDocument.load(bytes);
                    const copied = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    copied.forEach(p => mergedPdf.addPage(p));
                }

                const mergedBytes = await mergedPdf.save();
                downloadBytes(mergedBytes, 'merged.pdf', 'application/pdf');
                log('Selesai gabungkan PDF.');
            });
        },

        split() {
            toolPanel.innerHTML = `
                <h2 class="text-lg font-semibold mb-3">Pisahkan / Ekstrak Halaman</h2>
                <p class="text-xs text-gray-600 mb-3">
                    Pilih PDF, lalu masukkan range halaman yang ingin diambil, misalnya:
                    <code>1-3</code> atau <code>1,3,5</code>.
                </p>
                <input id="splitFile" type="file" accept="application/pdf" class="block mb-3 text-xs" />
                <input id="splitPages" type="text" placeholder="contoh: 1-3 atau 1,3,5"
                       class="border rounded px-2 py-1 text-xs w-full mb-3" />
                <button id="splitRun"
                        class="px-3 py-1.5 rounded bg-red-500 text-white text-xs font-semibold">
                    Ekstrak
                </button>
            `;

            document.getElementById('splitRun').addEventListener('click', async () => {
                const fileInput = document.getElementById('splitFile');
                const file = fileInput.files[0];
                if (!file) return alert('Pilih file PDF.');

                const spec = document.getElementById('splitPages').value.trim();
                if (!spec) return alert('Isi halaman yang ingin diambil.');

                const parsePages = (spec, max) => {
                    const set = new Set();
                    spec.split(',').forEach(part => {
                        part = part.trim();
                        if (!part) return;
                        if (part.includes('-')) {
                            let [a, b] = part.split('-').map(n => parseInt(n, 10));
                            if (isNaN(a) || isNaN(b)) return;
                            if (a > b) [a, b] = [b, a];
                            for (let i = a; i <= b; i++) if (i >= 1 && i <= max) set.add(i - 1);
                        } else {
                            const n = parseInt(part, 10);
                            if (!isNaN(n) && n >= 1 && n <= max) set.add(n - 1);
                        }
                    });
                    return Array.from(set).sort((x, y) => x - y);
                };

                log('Memuat PDF untuk split...');
                const bytes = await file.arrayBuffer();
                const pdf = await PDFLib.PDFDocument.load(bytes);
                const total = pdf.getPageCount();
                const pageIdx = parsePages(spec, total);
                if (!pageIdx.length) return alert('Tidak ada halaman valid dari input.');

                const out = await PDFLib.PDFDocument.create();
                const copied = await out.copyPages(pdf, pageIdx);
                copied.forEach(p => out.addPage(p));
                const outBytes = await out.save();
                downloadBytes(outBytes, 'extracted_pages.pdf', 'application/pdf');
                log('Halaman diekstrak: ' + pageIdx.map(i => i + 1).join(', '));
            });
        },

        deletePages() {
            toolPanel.innerHTML = `
                <h2 class="text-lg font-semibold mb-3">Hapus Halaman</h2>
                <p class="text-xs text-gray-600 mb-3">
                    Pilih PDF lalu masukkan nomor halaman yang ingin <strong>dihapus</strong>,
                    misalnya <code>2</code> atau <code>2,4,6</code>.
                </p>
                <input id="delFile" type="file" accept="application/pdf" class="block mb-3 text-xs" />
                <input id="delPages" type="text" placeholder="contoh: 2 atau 2,4,6"
                       class="border rounded px-2 py-1 text-xs w-full mb-3" />
                <button id="delRun"
                        class="px-3 py-1.5 rounded bg-red-500 text-white text-xs font-semibold">
                    Hapus halaman
                </button>
            `;

            document.getElementById('delRun').addEventListener('click', async () => {
                const file = document.getElementById('delFile').files[0];
                if (!file) return alert('Pilih file PDF.');
                const spec = document.getElementById('delPages').value.trim();
                if (!spec) return alert('Isi halaman yang ingin dihapus.');

                const bytes = await file.arrayBuffer();
                const pdf = await PDFLib.PDFDocument.load(bytes);
                const total = pdf.getPageCount();

                const delSet = new Set();
                spec.split(',').forEach(p => {
                    const n = parseInt(p.trim(), 10);
                    if (!isNaN(n) && n >= 1 && n <= total) delSet.add(n - 1);
                });

                const keepIdx = [];
                for (let i = 0; i < total; i++) if (!delSet.has(i)) keepIdx.push(i);

                const out = await PDFLib.PDFDocument.create();
                const copied = await out.copyPages(pdf, keepIdx);
                copied.forEach(p => out.addPage(p));
                const outBytes = await out.save();
                downloadBytes(outBytes, 'deleted_pages.pdf', 'application/pdf');
                log('Halaman dihapus: ' + Array.from(delSet).map(i => i + 1).join(', '));
            });
        },

        reorder() {
            toolPanel.innerHTML = `
                <h2 class="text-lg font-semibold mb-3">Atur Urutan Halaman</h2>
                <p class="text-xs text-gray-600 mb-3">
                    Pilih PDF lalu masukkan urutan baru. Contoh:
                    <code>2,1,3</code> (tukar halaman 1 & 2).
                </p>
                <input id="ordFile" type="file" accept="application/pdf" class="block mb-3 text-xs" />
                <input id="ordSpec" type="text" placeholder="contoh: 2,1,3"
                       class="border rounded px-2 py-1 text-xs w-full mb-3" />
                <button id="ordRun"
                        class="px-3 py-1.5 rounded bg-red-500 text-white text-xs font-semibold">
                    Atur urutan
                </button>
            `;

            document.getElementById('ordRun').addEventListener('click', async () => {
                const file = document.getElementById('ordFile').files[0];
                if (!file) return alert('Pilih file PDF.');

                const spec = document.getElementById('ordSpec').value.trim();
                if (!spec) return alert('Isi urutan halaman.');

                const bytes = await file.arrayBuffer();
                const pdf = await PDFLib.PDFDocument.load(bytes);
                const total = pdf.getPageCount();

                const order = spec.split(',').map(s => parseInt(s.trim(), 10) - 1);
                if (order.length !== total || order.some(n => isNaN(n) || n < 0 || n >= total)) {
                    return alert('Urutan harus berisi seluruh halaman 1..' + total);
                }

                const out = await PDFLib.PDFDocument.create();
                const copied = await out.copyPages(pdf, order);
                copied.forEach(p => out.addPage(p));
                const outBytes = await out.save();
                downloadBytes(outBytes, 'reordered.pdf', 'application/pdf');
                log('Urutan baru: ' + spec);
            });
        },

        scanToPdf() {
            // sama dengan imagesToPdf
            this.imagesToPdf();
        },

        imagesToPdf() {
            toolPanel.innerHTML = `
                <h2 class="text-lg font-semibold mb-3">Gambar (JPG/PNG) ke PDF</h2>
                <p class="text-xs text-gray-600 mb-3">
                    Pilih satu atau beberapa gambar. Setiap gambar akan menjadi 1 halaman PDF.
                </p>
                <input id="imgFiles" type="file" accept="image/*" multiple class="block mb-3 text-xs" />
                <button id="imgRun"
                        class="px-3 py-1.5 rounded bg-yellow-500 text-white text-xs font-semibold">
                    Buat PDF
                </button>
            `;

            document.getElementById('imgRun').addEventListener('click', async () => {
                const files = Array.from(document.getElementById('imgFiles').files || []);
                if (!files.length) return alert('Pilih gambar.');

                const pdfDoc = await PDFLib.PDFDocument.create();

                for (const file of files) {
                    const bytes = await file.arrayBuffer();
                    let img;
                    if (file.type === 'image/png') {
                        img = await pdfDoc.embedPng(bytes);
                    } else {
                        img = await pdfDoc.embedJpg(bytes);
                    }
                    const { width, height } = img;
                    const page = pdfDoc.addPage([width, height]);
                    page.drawImage(img, { x: 0, y: 0, width, height });
                }

                const outBytes = await pdfDoc.save();
                downloadBytes(outBytes, 'images_to_pdf.pdf', 'application/pdf');
                log('Gambar dikonversi ke PDF.');
            });
        },

        compress() {
            toolPanel.innerHTML = `
                <h2 class="text-lg font-semibold mb-3">Kompres (Re-save) PDF</h2>
                <p class="text-xs text-gray-600 mb-3">
                    Frontend-only tidak bisa kompres se-agresif server.
                    Fitur ini hanya <strong>re-save</strong> PDF yang kadang bisa mengecilkan ukuran sedikit.
                </p>
                <input id="cmpFile" type="file" accept="application/pdf" class="block mb-3 text-xs" />
                <button id="cmpRun"
                        class="px-3 py-1.5 rounded bg-green-500 text-white text-xs font-semibold">
                    Kompres ringan
                </button>
            `;

            document.getElementById('cmpRun').addEventListener('click', async () => {
                const file = document.getElementById('cmpFile').files[0];
                if (!file) return alert('Pilih file PDF.');

                const bytes = await file.arrayBuffer();
                const pdf = await PDFLib.PDFDocument.load(bytes, { updateMetadata: true });
                const outBytes = await pdf.save({ useObjectStreams: true });
                downloadBytes(outBytes, 'compressed_light.pdf', 'application/pdf');
                log('PDF disimpan ulang (kompres ringan).');
            });
        },

        rotate() {
            toolPanel.innerHTML = `
                <h2 class="text-lg font-semibold mb-3">Putar Halaman</h2>
                <p class="text-xs text-gray-600 mb-3">
                    Pilih PDF dan pilih sudut rotasi. Berlaku untuk <strong>semua</strong> halaman.
                </p>
                <input id="rotFile" type="file" accept="application/pdf" class="block mb-3 text-xs" />
                <select id="rotAngle" class="border rounded px-2 py-1 text-xs mb-3">
                    <option value="90">90Â° searah jarum jam</option>
                    <option value="180">180Â°</option>
                    <option value="270">270Â°</option>
                </select>
                <button id="rotRun"
                        class="px-3 py-1.5 rounded bg-pink-500 text-white text-xs font-semibold">
                    Putar
                </button>
            `;

            document.getElementById('rotRun').addEventListener('click', async () => {
                const file = document.getElementById('rotFile').files[0];
                if (!file) return alert('Pilih file PDF.');
                const angle = parseInt(document.getElementById('rotAngle').value, 10);

                const bytes = await file.arrayBuffer();
                const pdf = await PDFLib.PDFDocument.load(bytes);
                const pages = pdf.getPages();
                pages.forEach(p => p.setRotation(PDFLib.degrees(angle)));
                const outBytes = await pdf.save();
                downloadBytes(outBytes, 'rotated.pdf', 'application/pdf');
                log('Semua halaman diputar ' + angle + 'Â°.');
            });
        },

        pageNumbers() {
            toolPanel.innerHTML = `
                <h2 class="text-lg font-semibold mb-3">Nomor Halaman</h2>
                <p class="text-xs text-gray-600 mb-3">
                    Tambahkan nomor halaman di bawah-tengah tiap halaman.
                </p>
                <input id="numFile" type="file" accept="application/pdf" class="block mb-3 text-xs" />
                <button id="numRun"
                        class="px-3 py-1.5 rounded bg-pink-500 text-white text-xs font-semibold">
                    Tambah nomor
                </button>
            `;

            document.getElementById('numRun').addEventListener('click', async () => {
                const file = document.getElementById('numFile').files[0];
                if (!file) return alert('Pilih file PDF.');

                const bytes = await file.arrayBuffer();
                const pdf = await PDFLib.PDFDocument.load(bytes);
                const pages = pdf.getPages();
                const font = await pdf.embedFont(PDFLib.StandardFonts.Helvetica);

                pages.forEach((page, idx) => {
                    const { width } = page.getSize();
                    const text = `${idx + 1} / ${pages.length}`;
                    const fontSize = 10;
                    const textWidth = font.widthOfTextAtSize(text, fontSize);
                    page.drawText(text, {
                        x: (width - textWidth) / 2,
                        y: 20,
                        size: fontSize,
                        font,
                        color: PDFLib.rgb(0.3, 0.3, 0.3)
                    });
                });

                const outBytes = await pdf.save();
                downloadBytes(outBytes, 'page_numbers.pdf', 'application/pdf');
                log('Nomor halaman ditambahkan.');
            });
        },

        watermark() {
            toolPanel.innerHTML = `
                <h2 class="text-lg font-semibold mb-3">Watermark Teks</h2>
                <p class="text-xs text-gray-600 mb-3">
                    Tambahkan watermark teks diagonal di setiap halaman.
                </p>
                <input id="wmFile" type="file" accept="application/pdf" class="block mb-3 text-xs" />
                <input id="wmText" type="text" placeholder="contoh: CONFIDENTIAL"
                       class="border rounded px-2 py-1 text-xs w-full mb-3" />
                <button id="wmRun"
                        class="px-3 py-1.5 rounded bg-pink-500 text-white text-xs font-semibold">
                    Tambah watermark
                </button>
            `;

            document.getElementById('wmRun').addEventListener('click', async () => {
                const file = document.getElementById('wmFile').files[0];
                if (!file) return alert('Pilih file PDF.');
                const text = document.getElementById('wmText').value.trim() || 'CONFIDENTIAL';

                const bytes = await file.arrayBuffer();
                const pdf = await PDFLib.PDFDocument.load(bytes);
                const pages = pdf.getPages();
                const font = await pdf.embedFont(PDFLib.StandardFonts.HelveticaBold);

                pages.forEach(page => {
                    const { width, height } = page.getSize();
                    const fontSize = 40;
                    const textWidth = font.widthOfTextAtSize(text, fontSize);

                    page.drawText(text, {
                        x: (width - textWidth) / 2,
                        y: height / 2,
                        size: fontSize,
                        font,
                        rotate: PDFLib.degrees(45),
                        opacity: 0.2,
                        color: PDFLib.rgb(0.7, 0, 0)
                    });
                });

                const outBytes = await pdf.save();
                downloadBytes(outBytes, 'watermarked.pdf', 'application/pdf');
                log('Watermark ditambahkan.');
            });
        },

        pdfToImages() {
            toolPanel.innerHTML = `
                <h2 class="text-lg font-semibold mb-3">PDF ke Gambar (PNG)</h2>
                <p class="text-xs text-gray-600 mb-3">
                    Frontend-only contoh sederhana: render semua halaman PDF jadi PNG lalu otomatis di-download.
                </p>
                <input id="p2iFile" type="file" accept="application/pdf" class="block mb-3 text-xs" />
                <button id="p2iRun"
                        class="px-3 py-1.5 rounded bg-yellow-500 text-white text-xs font-semibold">
                    Convert ke PNG
                </button>
                <canvas id="p2iCanvas" class="hidden"></canvas>
            `;

            document.getElementById('p2iRun').addEventListener('click', async () => {
                const file = document.getElementById('p2iFile').files[0];
                if (!file) return alert('Pilih file PDF.');

                log('Render PDF ke PNG, bisa agak lambat untuk banyak halaman...');
                const arrayBuff = await file.arrayBuffer();

                // load pdf.js sebagai module dinamis
                const pdfjs = await import("https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.min.mjs");
                const loadingTask = pdfjs.getDocument({ data: arrayBuff });
                const pdf = await loadingTask.promise;

                const canvas = document.getElementById('p2iCanvas');
                const ctx = canvas.getContext('2d');

                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    const viewport = page.getViewport({ scale: 1.5 });
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;

                    await page.render({ canvasContext: ctx, viewport }).promise;

                    const dataUrl = canvas.toDataURL("image/png");
                    const a = document.createElement('a');
                    a.href = dataUrl;
                    a.download = `page_${pageNum}.png`;
                    a.click();
                    log('Halaman ' + pageNum + ' di-download sebagai PNG.');
                }
            });
        }
    };

    // Bind menu click
    document.querySelectorAll('.tool-item').forEach(item => {
        item.addEventListener('click', () => {
            const tool = item.getAttribute('data-tool');
            if (tool && tools[tool]) {
                tools[tool]();
                log('Tool dibuka: ' + tool);
            }
        });
    });
</script>

</body>
</html>
