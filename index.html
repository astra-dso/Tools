<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <title>Modern Gemini AI Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- Google Fonts (optional, biar lebih modern & clean) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  >

  <style>
    :root {
      --bg-body: #f5f7fb;
      --bg-card: #ffffff;
      --border-soft: #e3e7f0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: var(--bg-body);
      color: #1f2933;
    }

    .chat-wrapper {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px 12px;
    }

    .chat-card {
      width: 100%;
      max-width: 960px;
      border-radius: 24px;
      border: 1px solid var(--border-soft);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.07);
      background: radial-gradient(circle at top left, #f9fbff 0, #ffffff 40%, #ffffff 100%);
    }

    .chat-header {
      border-bottom: 1px solid var(--border-soft);
    }

    .chat-header-icon {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-weight: 700;
      font-size: 18px;
    }

    .chat-header-subtitle {
      font-size: 0.875rem;
      color: #64748b;
    }

    .chat-body {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 16px 20px 16px 20px;
    }

    /* Chat area height: responsive */
    #chat-box {
      height: clamp(320px, 60vh, 520px);
      overflow-y: auto;
      padding-right: 4px;
    }

    .chat-bubble {
      max-width: 80%;
      border-radius: 18px;
      padding: 10px 14px;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .chat-bubble-user {
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      color: #ffffff;
    }

    .chat-bubble-ai {
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      color: #111827;
    }

    .ai-avatar {
      width: 32px;
      height: 32px;
      border-radius: 12px;
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-size: 0.8rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .suggestion-chip {
      border-radius: 999px;
      font-size: 0.85rem;
    }

    .chat-input-wrapper {
      border-radius: 18px;
      border: 1px solid var(--border-soft);
      background-color: #f9fafb;
    }

    .chat-input-wrapper:focus-within {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.1);
    }

    .form-control:focus {
      box-shadow: none;
      border-color: transparent;
    }

    .btn-send {
      min-width: 110px;
      border-radius: 999px;
      font-weight: 600;
    }

    /* Scrollbar halus */
    #chat-box::-webkit-scrollbar {
      width: 6px;
    }

    #chat-box::-webkit-scrollbar-thumb {
      background-color: #d1d5db;
      border-radius: 999px;
    }

    @media (max-width: 575.98px) {
      .chat-card {
        border-radius: 18px;
      }

      .chat-body {
        padding-inline: 14px;
      }

      .chat-bubble {
        max-width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="chat-wrapper">
    <div class="chat-card">
      <!-- HEADER -->
      <div class="chat-header px-4 px-sm-5 py-3 d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center gap-3">
          <div class="chat-header-icon">
            G
          </div>
          <div>
            <h1 class="h5 mb-1">Gemini Chat</h1>
            <p class="chat-header-subtitle mb-0">
              Tanyakan apa saja – seputar kerja, code, ide, atau hal lain.
            </p>
          </div>
        </div>
        <div class="d-none d-md-flex flex-column text-end small text-muted">
          <span>Status: <span class="badge rounded-pill text-bg-success">Online</span></span>
          <span id="model-name" class="mt-1">Model: gemini-2.5-flash</span>
        </div>
      </div>

      <!-- BODY -->
      <div class="chat-body">
        <!-- SUGGESTIONS (AI GENERATED) -->
        <div class="mb-1">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="text-muted small">Saran pertanyaan untukmu</span>
            <button id="refreshSuggestions"
                    class="btn btn-link btn-sm text-decoration-none p-0">
              Acak ulang
            </button>
          </div>
          <div id="suggestions" class="d-flex flex-wrap gap-2">
            <!-- Akan diisi AI -->
          </div>
        </div>

        <!-- CHAT BOX -->
        <div id="chat-box" class="mt-1">
          <!-- Initial AI message -->
          <div class="d-flex align-items-start gap-2 mb-3">
            <div class="ai-avatar">AI</div>
            <div class="chat-bubble chat-bubble-ai shadow-sm">
              Halo, saya <strong>Gemini</strong>. Silakan tanya apa saja. ✨<br>
              Kamu bisa klik salah satu saran di atas kalau bingung mau mulai dari mana.
            </div>
          </div>
        </div>

        <!-- INPUT -->
        <div class="mt-2">
          <div class="chat-input-wrapper d-flex align-items-center px-2">
            <input id="prompt"
                   class="form-control border-0 bg-transparent py-3"
                   placeholder="Tulis pertanyaan atau instruksi kamu di sini..." />
            <button id="sendBtn"
                    class="btn btn-primary btn-send ms-2 d-flex align-items-center justify-content-center gap-1">
              <span>Kirim</span>
              <span class="d-none spinner-border spinner-border-sm" id="sendSpinner" role="status"
                aria-hidden="true"></span>
            </button>
          </div>
          <div class="d-flex justify-content-between mt-2 small text-muted">
            <span>Tekan <kbd>Enter</kbd> untuk kirim.</span>
            <span id="statusText"></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (optional for some components) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Gemini + Chat Logic -->
  <script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    // =========================================
    //   KONFIGURASI GEMINI
    // =========================================
    const API_KEY = "AIzaSyBlyZScLwO6NnvfqiInNf2saHFajvI4-N8"; // TODO: ganti dengan API key kamu
    const genAI = new GoogleGenerativeAI(API_KEY);
    const modelName = "gemini-2.5-flash";
    const model = genAI.getGenerativeModel({ model: modelName });

    // =========================================
    //   ELEMENT DOM
    // =========================================
    const chatBox = document.getElementById("chat-box");
    const promptInput = document.getElementById("prompt");
    const sendBtn = document.getElementById("sendBtn");
    const sendSpinner = document.getElementById("sendSpinner");
    const statusText = document.getElementById("statusText");
    const suggestionsBox = document.getElementById("suggestions");
    const refreshSuggestionsBtn = document.getElementById("refreshSuggestions");
    const modelNameLabel = document.getElementById("model-name");

    modelNameLabel.textContent = `Model: ${modelName}`;

    // =========================================
    //   UTILITY: SCROLL KE BAWAH
    // =========================================
    function scrollToBottom() {
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // =========================================
    //   UTILITY: TAMBAH PESAN
    // =========================================
    function addMessage(role, text, { isLoading = false } = {}) {
      const wrapper = document.createElement("div");

      if (role === "user") {
        wrapper.className = "d-flex justify-content-end mb-3";
        const bubble = document.createElement("div");
        bubble.className = "chat-bubble chat-bubble-user shadow-sm";
        bubble.textContent = text;
        wrapper.appendChild(bubble);
      } else {
        wrapper.className = "d-flex align-items-start gap-2 mb-3";

        const avatar = document.createElement("div");
        avatar.className = "ai-avatar";
        avatar.textContent = "AI";

        const bubble = document.createElement("div");
        bubble.className = "chat-bubble chat-bubble-ai shadow-sm";

        if (isLoading) {
          bubble.innerHTML = `
            <span class="placeholder-wave d-inline-block" style="width: 90%;">
              <span class="placeholder col-10"></span>
              <span class="placeholder col-7"></span>
            </span>
          `;
        } else {
          bubble.textContent = text;
        }

        wrapper.appendChild(avatar);
        wrapper.appendChild(bubble);
      }

      chatBox.appendChild(wrapper);
      scrollToBottom();

      return wrapper;
    }

    // =========================================
    //   SUGGESTIONS: GENERATED BY AI
    // =========================================
    async function loadSuggestions() {
      suggestionsBox.innerHTML =
        `<span class="text-muted small">Mengambil saran dari AI...</span>`;

      try {
        const promptForSuggestions = `
          Berikan 8 contoh pertanyaan singkat dan variatif dalam bahasa Indonesia
          yang cocok untuk diajukan ke asisten AI seputar:
          - pekerjaan & produktivitas,
          - pemrograman / teknologi,
          - pengembangan diri,
          - ide kreatif.

          Jawab hanya dengan list poin tanpa nomor, satu pertanyaan per baris.
        `;

        const result = await model.generateContent(promptForSuggestions);
        const text = result.response.text();

        let lines = text
          .split(/\r?\n/)
          .map((l) => l.replace(/^[-*\d.\s]+/, "").trim())
          .filter((l) => l.length > 0);

        if (!lines.length) {
          throw new Error("Respons kosong dari model.");
        }

        // Acak urutan (random) dan ambil 4
        lines = lines.sort(() => Math.random() - 0.5);
        const selected = lines.slice(0, 4);

        suggestionsBox.innerHTML = "";
        selected.forEach((item) => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "btn btn-outline-secondary suggestion-chip px-3 py-1";
          btn.textContent = item;
          btn.onclick = () => {
            promptInput.value = item;
            sendMessage();
          };
          suggestionsBox.appendChild(btn);
        });
      } catch (error) {
        console.error(error);
        suggestionsBox.innerHTML =
          `<span class="text-danger small">Gagal memuat saran. Coba klik "Acak ulang".</span>`;
      }
    }

    // =========================================
    //   KIRIM PESAN
    // =========================================
    let isSending = false;

    async function sendMessage() {
      const prompt = promptInput.value.trim();
      if (!prompt || isSending) return;

      isSending = true;
      statusText.textContent = "Mengirim...";
      sendSpinner.classList.remove("d-none");
      sendBtn.disabled = true;

      // Tambah pesan user
      addMessage("user", prompt);
      promptInput.value = "";

      // Tambah bubble loading AI
      const aiWrapper = addMessage("ai", "", { isLoading: true });
      const aiBubble = aiWrapper.querySelector(".chat-bubble-ai");

      try {
        const result = await model.generateContent(prompt);
        const reply = result.response.text();

        // Ganti isi bubble dengan jawaban AI
        aiBubble.textContent = reply;
        statusText.textContent = "Siap membantu ✨";

        // Optionally: generate new suggestions kadang-kadang (random 30%)
        if (Math.random() < 0.3) {
          loadSuggestions();
        }
      } catch (err) {
        console.error(err);
        aiBubble.textContent = "❌ Terjadi kesalahan: " + err.message;
        statusText.textContent = "Terjadi kesalahan.";
      } finally {
        isSending = false;
        sendSpinner.classList.add("d-none");
        sendBtn.disabled = false;
        scrollToBottom();
      }
    }

    // =========================================
    //   EVENT LISTENER
    // =========================================
    sendBtn.addEventListener("click", sendMessage);

    promptInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    refreshSuggestionsBtn.addEventListener("click", () => {
      loadSuggestions();
    });

    // =========================================
    //   INIT
    // =========================================
    statusText.textContent = "Menyiapkan saran dari AI...";
    loadSuggestions();
  </script>
</body>

</html
